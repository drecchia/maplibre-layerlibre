<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>LayersControl Persistence Example</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- MapLibre GL CSS -->
	<link href="https://unpkg.com/maplibre-gl@4.1.1/dist/maplibre-gl.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/deck.gl@9.1.14/dist/stylesheet.min.css">
	<link href="../dist/css/all.css" rel="stylesheet">
	<style>
		html,
		body,
		#map {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		#map {
			width: 100vw;
			height: 100vh;
		}

		.test-info {
			position: absolute;
			top: 10px;
			right: 10px;
			background: white;
			padding: 15px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			max-width: 300px;
			z-index: 1000;
		}

		.test-info h3 {
			margin: 0 0 10px 0;
			color: #333;
		}

		.test-info ul {
			margin: 0;
			padding-left: 20px;
		}

		.test-info li {
			margin-bottom: 5px;
			font-size: 14px;
		}

		.test-info button {
			margin-top: 10px;
			padding: 6px 14px;
			border-radius: 4px;
			border: 1px solid #ccc;
			background: #f5f5f5;
			cursor: pointer;
			font-size: 13px;
		}

		.test-info button:hover {
			background: #e0e0e0;
		}
	</style>
</head>

<body>
	<div id="map"></div>
	<div class="test-info">
		<h3>ðŸ§ª Persistence</h3>
		<ul>
			<li>Persistence: State is saved/restored. Reload to test.</li>
			<li>Use the button to clear state and reset the demo.</li>
		</ul>
		<button onclick="clearLayersState()">Clear State</button>
	</div>
	<!-- MapLibre GL JS -->
	<script src="https://unpkg.com/maplibre-gl@4.1.1/dist/maplibre-gl.js"></script>
	<!-- Deck.gl CDN -->
	<script src="https://cdn.jsdelivr.net/npm/deck.gl@9.1.14/dist.min.js"></script>
	<!-- LayersControl JS -->
	<script src="../dist/js/all.min.js"></script>
	<script>
		const baseStyles = [
			{
				id: 'osm',
				label: 'OpenStreetMap',
				style: 'https://demotiles.maplibre.org/style.json',
				strategy: 'setStyle'
			}
		];

		const overlays = [
			{
				id: 'persist-point',
				label: 'Persistent Point',
				deckLayers: [
					{
						id: 'persist-point-layer',
						type: 'ScatterplotLayer',
						props: {
							data: [
								{ position: [-46.8, -22.1], name: 'Null Island' },
								{ position: [-46.4, -22.5], name: 'Point 2' }
							],
							getPosition: d => d.position,
							getRadius: 8000,
							getFillColor: [255, 0, 0], // red rgb
							getLineColor: [0, 0, 255], // blue rgb
							lineWidthMinPixels: 2,
							pickable: true
						}
					}
				],
				defaultVisible: false
			}
		];

		const persistKey = 'layerscontrol-persistence-demo';

		const eventEmitter = new EventEmitter();
		const stateService = new StateService(eventEmitter, 'layersControlState');
		const mapService = new MapService(eventEmitter);
		const uiService = new UIService(stateService, mapService, eventEmitter);
		const businessLogicService = new BusinessLogicService(stateService, eventEmitter);

		const map = new maplibregl.Map({
			container: 'map',
			style: baseStyles[0].style,
			center: [-46.4, -22.5],
			zoom: 7
		});

		const layersControl = new LayersControl({
			baseStyles: baseStyles,
			overlays: overlays,
			defaultBaseId: 'osm'
		}, {
			stateService,
			uiService,
			mapService,
			businessLogicService,
			eventEmitter
		});

		map.addControl(layersControl, 'top-left');

		window.clearLayersState = function () {
			layersControl.clearPersistedData();
			location.reload();
		};
	</script>
</body>

</html>
